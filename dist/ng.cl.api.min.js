!function(a){"use strict";function b(b){return null!==b&&a.isObject(b)&&!a.isArray(b)}function c(a){return"[object RegExp]"===window.toString.call(a)}function d(a){return a&&t(a.then)}function e(a){return a=a||"",/\/$/.test(a)?a:a+="/"}function f(a,b){if(a!==b)if(s(b))a=new Date(b.getTime());else if(c(b))a=new RegExp(b.source,b.toString().match(/[^\/]*$/)[0]),a.lastIndex=b.lastIndex;else if(u(b)){v(b)?v(a)||(a=[]):(!u(a)||v(a))&&(a={});for(var d in b)a[d]=f(a[d],b[d])}else"undefined"!=typeof b&&(a=b);return a}function g(a,c){if(r(c))c={name:a,$constructor:c};else if(t(c))c={name:a,$new:c};else{if(!b(c))throw new Error('Invalid options for model "'+a+'".');if(c=q(c),c.name=a,delete c.$new,!r(c.$constructor)&&!t(c.$constructor))throw new Error('Invalid "constructor" in options for model "'+a+'".')}if(c.service=c.service||null,c.methods=c.methods||[],!v(c.methods))throw new Error('Invalid "methods" in options for model "'+a+'".');return c}function h(a){var c,d,e=a.methods;for(d=0;d<e.length;d++){if(c=e[d],r(c)&&(c=e[d]={name:c}),!u(c))throw new Error('Invalid options for method of model "'+a.name+'".');if(!c.name||!r(c.name)||!c.name.length)throw new Error('Invalid "name" in options for method "undefined" of model "'+a.name+'".');if(c.hasOwnProperty("method")&&!t(c.method)&&!r(c.method))throw new Error('Invalid "method" in options for method "'+c.name+'" of model "'+a.name+'".');if(!t(c.method)&&(c.service=c.service||a.service,c.method=c.method||c.name,c.xyz=c.xyz||a.xyz||null,!c.service||!b(c.service)&&!r(c.service)))throw new Error('Invalid "service" in options for method "'+c.name+'" of model "'+a.name+'".')}}function i(a,b,c){return function(d){r(c.$constructor)&&(c.$constructor=b.get(c.$constructor));var e=new c.$constructor(d);return j(a,c,e),e}}function j(b,c,d){var e,f,g,h=c.methods;for(f=0;f<h.length;f++)e=h[f],g=t(e.method)?a.bind(d,e.method):k(b,d,e),Object.defineProperty(d,e.name,{enumerable:!1,configurable:!1,value:g})}function k(a,b,c){return r(c.service)&&(c.service=a.service(c.service)),function(){var a=[].slice.call(arguments);a.unshift(b);var e=c.service[c.method].apply(c.service,a);return d(e)&&c.xyz&&e.then(function(a){return b[c.xyz](a),a}),e}}function l(a,b){var c,d,e,f=b||{},g=a.replace(/(\/)?:(\w+)(\?|\*)?/g,function(b,g,h,i){if(c=f.hasOwnProperty(h),"?"!==i&&!c)throw new Error('Missing parameter "'+h+'" when compiling URL for pattern "'+a+'".');return d=":"+h,"?"===i?(d+="\\?",c&&f[h]||(d="/"+d)):"*"===i&&(d+="\\*"),e=c&&f[h]||"",b.replace(new RegExp(d),e)});return g}function m(a,b,c,e,f){function g(b){j<k.length?(h="request"===c?k[j](e):k[j](e,b),a.all([h]).then(function(a){"request"===c&&"undefined"!=typeof a[0]?i.resolve(a[0]):"error"===c&&d(h)&&"undefined"!=typeof a[0]?i.resolve(a[0]):g("undefined"!=typeof a[0]?a[0]:b)},function(a){i.reject(a)}),j++):"error"===c?i.reject(b):i.resolve(b)}var h,i=a.defer(),j=0,k=b[c];return g(f),i.promise}function n(a,c,d){var e=d?q(d):{};if(c.config=f(e,c.config),!b(c))throw new Error('Invalid options for service method "'+a+'".');if(!r(c.pattern))throw new Error('Invalid pattern for service method "'+a+'".');if(!r(c.verb))throw new Error('Invalid verb for service method "'+a+'".')}function o(b,c,d){function e(e){var f=e.config;return f.method=d.verb,a.isString(d.pattern)&&(f.url=l(d.pattern,e.urlParams)),c(f).then(function(a){return m(b,d,"success",e,a)},function(a){return m(b,d,"error",e,a).then(function(a){return a},function(a){return b.reject(a)})})}return d.args=d.args||a.noop,d.request=d.request||[],d.success=d.success||[],d.error=d.error||[],function(){var a=Array.prototype.slice.call(arguments),c=new x(d.config);return c.replay=function(a){return f(c,a),e(c)},a.unshift(c),d.args.apply(null,a),m(b,d,"request",c).then(function(a){return a?a:e(c)})}}var p=a.module("ng.cl.api",[]),q=a.copy,r=a.isString,s=a.isDate,t=a.isFunction,u=a.isObject,v=a.isArray,w=["params","data","headers","xsrfHeaderName","xsrfCookieName","transformRequest","transformResponse","cache","timeout","withCredentials","responseType"],x=function(a){f(this,a)};Object.defineProperty(x.prototype,"config",{get:function(){var a={};for(var b in this)-1!==w.indexOf(b)&&(a[b]=q(this[b]));return a}}),p.factory("ClRequest",[function(){return x}]),p.factory("ClModel",[function(){var a=function(a){var b=this;a&&b.$merge(a)};return Object.defineProperty(a.prototype,"$empty",{value:function(){for(var a in this)this.hasOwnProperty(a)&&delete this[a]}}),Object.defineProperty(a.prototype,"$replace",{configurable:!0,value:function(a){this.$empty(),f(this,a),this.$decorate()}}),Object.defineProperty(a.prototype,"$merge",{value:function(a){f(this,a),this.$decorate()}}),Object.defineProperty(a.prototype,"$decorate",{configurable:!0,value:function(){}}),a}]),p.factory("ClApiAbstractService",["$q",function(b){var c=function(c){var d=this;if(c=a.copy(c),!t(c.execute))throw new Error('Invalid execute fn for service "'+d.name+'".');var e,f=c.methods||{};for(e in f)n(e,f[e],c.all),Object.defineProperty(d,e,{value:o(b,c.execute,f[e])});Object.defineProperty(this,"name",{get:function(){return c.name}})};return c}]),p.factory("ClApi",["$injector","$http","ClApiAbstractService",function(c,d,j){function k(a,b){return/^(http[s]?:)?\/\//.test(b)||(/^\//.test(b)&&(b=b.substring(1)),b=a+b),b}var l={baseUrl:"/"},m=function(m){var n=this;m=f(q(l),m||{}),m.baseUrl=e(m.baseUrl);var o={};n.middleware=function(a,b){if(!r(a))throw new Error("Invalid middleware name.");if(arguments.length>1){if(b[a])throw new Error('middleware "'+a+'" is already registered.');if(t(b)&&(o[a]=b),!t(b))throw new Error('Invalid middleware "'+a+'".');return o[a]=b,this}if(!o[a])throw new Error('Unknown middleware "'+a+'".');return o[a]};var p={};n.model=function(a,b){if(!r(a))throw new Error("Invalid model name.");if(arguments.length>1){if(p[a])throw new Error('Model "'+a+'" is already registered.');return b=g(a,b),h(b),b.$new=b.$new||i(n,c,b),p[a]=b,this}if(!p[a])throw new Error('Unknown model "'+a+'".');return p[a]};var s={},u={};n.service=function(a,d){if(!r(a))throw new Error("Invalid service name.");if(arguments.length>1){if(s[a])throw new Error('Service "'+a+'" is already registered.');if(b(d))s[a]=function(){return new j(d)};else if(r(d))s[a]=function(){return c.get(a)};else{if(!t(d))throw new Error('Invalid factory or configuration for service "'+a+'".');s[a]=d}return this}if(!u[a]){if(!s[a])throw new Error('Unknown service "'+a+'".');u[a]=s[a]()}return u[a]},n.execute=function(b){var c=a.isFunction(b.url)?b.url(b):b.url;return c=c||"",b.url=k(m.baseUrl,c),d(b)},Object.defineProperty(this,"baseUrl",{get:function(){return m.baseUrl}})};return m}])}(angular);