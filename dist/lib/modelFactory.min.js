!function(a){"use strict";var b=a.module("ng.cork.model.factory",["ng.cork.util"]),c=a.copy,d=a.isString,e=a.isFunction,f=a.isObject;b.service("corkModelFactory",["$injector","corkUtil",function(b,g){function h(a){var b,f,g,h,i;if(!m(a))throw new Error("Invalid model options.");if(b=a.name,a=c(a),f=a.hasOwnProperty("$constructor"),g=a.hasOwnProperty("$new"),h=f&&(d(a.$constructor)||e(a.$constructor)),i=g&&e(a.$new),f&&!h||g&&!i||!g&&!f)throw new Error('Invalid "$constructor" or "$new" in options for model "'+b+'".');if(a.service=a.service||null,a.methods=a.methods||{},!m(a.methods))throw new Error('Invalid "methods" in options for model "'+b+'".');return a}function i(a){var b,c,g=a.name,h=a.methods;for(c in h){if(b=h[c],null===b||d(b)||e(b))b=h[c]={method:b};else if(!f(b))throw new Error('Invalid options for method of model "'+g+'".');if(b.name=c,!d(b.name)||!b.name.length)throw new Error('Invalid method name in options of model "'+g+'".');if(b.hasOwnProperty("method")&&null!==b.method&&!e(b.method)&&!d(b.method))throw new Error('Invalid "method" in options for method "'+b.name+'" of model "'+g+'".');if(!e(b.method)&&(b.service=b.service||a.service,b.method=b.method||b.name,b.andThen=b.andThen||a.andThen||null,!b.service||!m(b.service)&&!d(b.service)))throw new Error('Invalid "service" in options for method "'+b.name+'" of model "'+g+'".')}}function j(a,b){var c;return c=b.$new?function(c){var d=b.$new(c);return k(a,b,d),d}:function(c){d(b.$constructor)&&(b.$constructor=a.get(b.$constructor));var e=b.$constructor,f=new e(c);return k(a,b,f),f},c.model=b,c}function k(b,c,d){var f,g,h,i=c.methods;for(g in i)f=i[g],h=e(f.method)?a.bind(d,f.method):l(b,d,f),Object.defineProperty(d,f.name,{enumerable:!1,configurable:!1,value:h})}function l(a,b,c){return d(c.service)&&(c.service=a.get(c.service)),function(){var a=[].slice.call(arguments);a.unshift(b);var d=c.service[c.method].apply(c.service,a);return n(d)&&c.andThen&&d.then(function(a){return b[c.andThen](a),a}),d}}var m=g.isObjectObject,n=g.isPromise;return{$new:function(a){return a=h(a),i(a),j(b,a)}}}])}(angular);